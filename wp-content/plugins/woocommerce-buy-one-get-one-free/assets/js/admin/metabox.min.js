!function(d){"undefined"!=typeof wc_admin_bogof_metabox_params&&(d.fn.true_false_switch=function(){function t(e){var t=e.attr("href"),t="yes"===d(t).val()?"enabled":"disabled";e.find("span.woocommerce-input-toggle").removeClass("woocommerce-input-toggle--enabled").removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--"+t)}return this.each(function(){d(this).on("click",function(e){e.preventDefault();e=d(this).attr("href");value="yes"==d(e).val()?"no":"yes",d(e).val(value),t(d(this)),d(e).trigger("change")}),t(d(this))}),this},d.fn.show_hide_fields=function(){return d(this).on("wc_bogo_field_change",function(){var i,e=d(this).data("show-if");e instanceof Array&&(i=!0,e.forEach(function(e){var t,o;i=i&&(t=e.field,o=e.operator,e=e.value,t=(d('[name="'+t+'"]').length?d('[name="'+t+'"]'):d("#"+t)).val(),"="==o?t==e:t!=e)}),d(this).toggle(i))}),this.each(function(){var t=d(this),e=t.data("show-if");e instanceof Array&&e.forEach(function(e){(d('[name="'+e.field+'"]').length?d('[name="'+e.field+'"]'):d("#"+e.field)).on("change",function(){t.triggerHandler("wc_bogo_field_change")})})}),this.each(function(){d(this).triggerHandler("wc_bogo_field_change")}),this},d.fn.table_multirow=function(){return this.each(function(){var e=d(this),i=e.find("table.wc-bogo-table>tbody").first();e.on("click","a.add-row",function(e){e.preventDefault();var e=d(this).attr("href"),e=wp.template(e),t=d(this).data(),o=i.find(">tr.row-input").last().data("rowId")+1,e=e(d.extend(t,{rowId:o}));i.append(e).find("[data-show-if]").show_hide_fields(),d(document.body).trigger("wc-enhanced-select-init")}),e.on("click","a.remove-row",function(e){e.preventDefault(),d(this).closest("tr").remove()})}),this},d.fn.wc_bogo_display_error=function(e,t){0<this.parent().find(".wc-bogo-error-tip").length&&this.wc_bogo_hide_errors(),this.parent().hasClass("wc-bogo-error-tip-wrap")||this.parent().addClass("wc-bogo-error-tip-wrap");var o=this.hasClass("select2-hidden-accessible")?this.parent().find("span.select2.select2-container"):this,i=d.extend(o.position(),{width:o.width(),height:o.height()}),e=d('<div class="wc-bogo-error-tip" style="display:none;">'+e+"</div>");return this.parent().append(e),e.css("left",i.left+i.width-i.width/2-d(".wc-bogo-error-tip").width()/2).css("top",i.top+i.height+4).fadeIn("100"),!0===t&&o.addClass("-hide-error-on-focus"),this},d.fn.wc_bogo_hide_errors=function(){return this.parent().find(".wc-bogo-error-tip").fadeOut("100",function(){d(this).remove()}),this.removeClass("-hide-error-on-focus"),this},wc_bogo_hide_all_errors=function(){d(".wc-bogo-error-tip").remove()},d.fn.wc_bogo_quantities=function(){var i=this;function o(){var e,t,o;"checking"==i.data("quantities_status")&&(e=d(this).closest("tr"),t=(e=e).find('[name^="_free_quantity"]'),o=parseInt(t.val(),10),e=parseInt(e.find('[name^="_min_quantity"]').val(),10),isNaN(o)||o<e?t.trigger("wc_bogo_remove_quantity_error"):t.trigger("wc_bogo_add_quantity_error"))}return i.on("wc_bogo_add_quantity_error",'[name^="_free_quantity"]',function(){d(this).wc_bogo_display_error(wc_admin_bogof_metabox_params.i18n.free_less_than_min_error)}),i.on("wc_bogo_remove_quantity_error",'[name^="_free_quantity"]',function(){d(this).wc_bogo_hide_errors()}),i.on("wc_bogo_checking_quantities",function(e,t){i.data("quantities_status",t?"checking":"off"),t?i.find('[name^="_min_quantity"]').each(o):i.find(".wc-bogo-error-tip").remove()}),i.on("keyup mouseup",'[name^="_free_quantity"]',o),i.on("change",'[name^="_min_quantity"]',o),this},d.fn.wc_bogo_postbox=function(){var t=this;function e(e){return e===t.find("#_type").val()}function o(){return"yes"===d("#_enabled").val()}return t.find(".wc-bogo-true-false").true_false_switch(),t.find(".wc-bogo-table-input").table_multirow(),t.find(".wc-bogo-field.-quantity_rules").wc_bogo_quantities().trigger("wc_bogo_checking_quantities",[e("cheapest_free")&&o()]),t.on("change","#_type",function(){t.find(".wc-bogo-field.-quantity_rules").trigger("wc_bogo_checking_quantities",[e("cheapest_free")&&o()])}),t.on("change","#_enabled",function(){t.find(".wc-bogo-field.-quantity_rules").trigger("wc_bogo_checking_quantities",[e("cheapest_free")&&o()]),o()||wc_bogo_hide_all_errors()}),t.find(".date-picker").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0}),t.find("[data-show-if]").show_hide_fields(),t.find(".wc-bogo-fields").removeClass("-loading"),t.find(".wc-bogo-field.-placeholder").remove(),t},d.fn.wc_bogo_submitpost=function(){var a=this,t=!1,r=!1;function s(){var e=a.find("#submitpost"),t=e.find('.button, [type="submit"]'),e=e.find(".spinner");t.addClass("disabled"),(t=e.last()).addClass("is-active"),t.css("display","inline-block"),wc_bogo_hide_all_errors(),d("#wc-bogo-validation-notice").hide()}function c(e){var t;d("#wc-bogo-validation-notice").length?(t=d("#wc-bogo-validation-notice")).hide():((t=d('<div id="wc-bogo-validation-notice" class="notice notice-error is-dismissible" style="display:none;"><p><strong></strong></p><button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button></div>')).on("click","button.notice-dismiss",function(){d(this).closest(".notice").fadeOut()}),t.insertBefore(a)),t.find("p>strong").text(e),t.fadeIn()}a.on("change focus",".-hide-error-on-focus",function(){d(this).wc_bogo_hide_errors()}),a.find(":submit").on("click.edit-post",function(e){var o,i,n;if(!1===t&&!e.isDefaultPrevented()&&!r)return s(),r=!1,i=!(o="wc_bogof_validate_save"),(n=a.serializeArray()).forEach(function(e,t){"action"===e.name&&(n[t].value=o,i=!0)}),i||n.push({name:"action",value:o}),e=n,t=d.ajax({url:wc_admin_bogof_metabox_params.ajaxurl,dataType:"json",type:"post",data:d.param(e),success:function(e){var t,o;Array.isArray(e)&&e.length?(o=!1,(e=e).forEach(function(e){var t=d("#_"+e.field);t.wc_bogo_display_error(e.message,!0),o=o||t}),c(1<(e=d(".-hide-error-on-focus").length)?wc_admin_bogof_metabox_params.i18n.fields_requires_attention.replace("%s",e):wc_admin_bogof_metabox_params.i18n.field_requires_attention),o&&o.length&&setTimeout(function(){d("html, body").animate({scrollTop:o.offset().top-d(window).height()/2},500)},10),t=(e=a.find("#submitpost")).find('.button, [type="submit"]'),e=e.find(".spinner, .acf-spinner"),t.removeClass("disabled"),(t=e).removeClass("is-active"),t.css("display","none")):r=!0},complete:function(){t=!1,r&&a.submit()},error:function(){a.submit()}}),!1})},d(document).ready(function(){d(".postbox.wc-bogo-postbox").wc_bogo_postbox(),d("form#post").wc_bogo_submitpost()}))}(jQuery);